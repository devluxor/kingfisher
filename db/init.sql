DROP TABLE IF EXISTS nests CASCADE;
DROP TABLE IF EXISTS requests;
DROP TABLE IF EXISTS ws_messages;

CREATE TABLE nests (
    id VARCHAR(22) PRIMARY KEY,
    origin_ip VARCHAR(50) NOT NULL,
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE requests (
    id VARCHAR(22) PRIMARY KEY,
    nest_id VARCHAR(22) REFERENCES nests(id) NOT NULL,
    method VARCHAR(500) NOT NULL,
    origin VARCHAR(65535) NOT NULL,
    origin_ip VARCHAR(15),
    path VARCHAR(65535) NOT NULL,
    query VARCHAR(65535) NOT NULL,
    headers VARCHAR(65535) NOT NULL,
    body VARCHAR(65535) NOT NULL,
    arrived_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE ws_messages (
    id VARCHAR(22) PRIMARY KEY,
    nest_id VARCHAR(22) REFERENCES nests(id) NOT NULL,
    server_URL VARCHAR(65535) NOT NULL,
    data VARCHAR(65535),
    arrived_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
